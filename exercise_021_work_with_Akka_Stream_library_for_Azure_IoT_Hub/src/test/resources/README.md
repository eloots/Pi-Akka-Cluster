# Exercise 21

## Work with the Akka Stream library for Azure IoT Hub.md
These exercise steps use Akka and Sccala act with a simulated Raspberry pi
device sending temperature and humidity data from a simulated BME280 sensor. 

**NOTE:** The scala samples interact with data generated by the the simulated
device that you created in the previous exercise.  Please
ensure that it is still running.

## Steps

### Ensure you have SBT on your laptop
To build the samples, you need to have SBT installed. You can download SBT from
[here](https://www.scala-sbt.org/download.html).

### Download the Akka Stream library for Azure IoT Hub

Retrieve the Akka Stream library for Azure IoT Hub code to your laptop:

```scala
   git clone https://github.com/Azure/toketi-iothubreact.git
```

You can also download a [zip file
here](https://github.com/Azure/toketi-iothubreact/master.zip)

### Update the Configuration file with values from the Iot Hub

By default IoTHubReact uses a configuration file for parameters required to
connect to Azure IoT Hub. 

- Open **/samples-scala/src/main/resources/application.conf** in a text editor
  of your choice.
- Open your IoT Hub in the [Azure Portal](https://portal.azure.com).  

Update the following properties with values from your IoT Hub values:

* **hubName**: see `Endpoints` ⇒ `Messaging` ⇒ `Events` ⇒ `Event Hub-compatible
  name`
* **hubEndpoint**: see `Endpoints` ⇒ `Messaging` ⇒ `Events` ⇒ `Event
  Hub-compatible endpoint`
* **hubPartitions**: see `Endpoints` ⇒ `Messaging` ⇒ `Events` ⇒ `Partitions`
  (should be the default of 4)
* **accessPolicy**: type `service`
* **accessKey**: see `Shared access policies` ⇒ `service` ⇒ `Primary key` (a
  base64 encoded string)
* **accessHostName**: see `Shared access policies` ⇒ `service` ⇒ `Connection
  string` ⇒ and copy just the `HostName`


### Build the Scala Samples using SBT

**NOTE:** The scala samples interact with data generated by the the simulated
device that you created in the previous exercise.  Please
ensure that it is still running at this point.

From the base directory (where sbt.build is located), build and run the Scala
samples using SBT: 

```scala
   run_scala_samples
```

The build will take a while to run the first and downloads many dependencies.
When done, you should be presented with a list of samples to run by number.  

For the purposes of this tutorial, we will run and discuss:

1.  [1] A_APIUSage.AllMessagesFromBeginning: stream all the events, starting from the current
   time.
17.  [17] D_Throttling.Demo: throttle the incoming stream to a defined speed of
   x events/second.

If time, have a look at the full list of [Java and Scala samples in the repo
documentation](https://github.com/Azure/toketi-iothubreact).
